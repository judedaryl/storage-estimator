<!DOCTYPE html>
<html>

<head>
    <title>Storage worth</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@tanstack/react-table@8.20.5/build/umd/index.development.js"></script>
</head>

<body>
    <div id="root"></div>
</body>

<script type="text/babel">

    function App() {
        const [data, setData] = React.useState();
        return (
            <div className="px-4 sm:px-6 lg:px-8 container py-4 mx-auto">
                <div>
                    <h3 className="text-base font-semibold leading-6 text-gray-900">Storage value</h3>
                </div>

                {!data ? (
                    <div className="mt-8">
                        <label htmlFor="data" className="block text-sm font-medium leading-6 text-gray-900">
                            Paste your storage summary here
                        </label>
                        <div className="mt-2">
                            <form onSubmit={e => {
                                e.preventDefault();
                                setData(JSON.parse(e.currentTarget.elements["data"].value))
                            }}>
                                <textarea
                                    id="data"
                                    name="data"
                                    rows={4}
                                    className="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
                                    defaultValue={''}
                                />

                                <Button type="submit" className="mt-3">Submit</Button>
                            </form>
                        </div>
                    </div>
                ) : (
                    <>

                        <Stats data={data}/>
                        <Table data={data} />

                        <Button className="mt-5 bg-red-500" onClick={() => setData()}>Reset</Button>
                    </>
                )}
            </div>
        )
    }
</script>
<script type="text/babel">
    function Stats({ data }) {
        const storageStats = React.useMemo(() => data.reduce((a, b) => {
            const key = `${b.storage}: ${b.account}`
            if (!!a[key]) {
                a[key] += b.total
            } else {
                a[key] = b.total
            }
            return a
        }, {}), [data])
        const total = data.reduce((a, b) => a += b.total, 0)

        return (
            <dl className="mt-5 grid grid-cols-1 gap-5 sm:grid-cols-3" id="stats">
                {Object.keys(storageStats).map(key => (
                    <div className="overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6">
                        <dt className="truncate text-sm font-medium text-gray-500">{key}</dt>
                        <dd className="mt-1 text-3xl font-semibold tracking-tight text-gray-900">{(storageStats[key]).toLocaleString()} Z</dd>
                    </div>
                ))}
            </dl>
        )
    }
</script>
<script type="text/babel">

    function Button({ children, ...props }) {
        return (
            <button
                {...props}
                type="submit"
                className={"inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 " + props.className}
            >
                {children}
            </button>
        )
    }
    function Table({ data }) {
        const columns = [
            {
                id: 'itemId',
                accessorKey: 'itemId',
                header: "Id",
                meta: {
                    className: "py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6 sticky top-0",
                    itemClassName: "whitespace-nowrap py-4 pl-4 pr-3 text-sm text-gray-900 sm:pl-6"
                }
            },
            {
                id: 'name',
                accessorKey: 'name',
                header: "Name",
                meta: {
                    className: "px-3 py-3.5 text-left text-sm font-semibold text-gray-900 sticky top-0",
                    itemClassName: "whitespace-nowrap px-3 py-4 text-sm text-gray-500"
                }
            },
            {
                id: 'price',
                accessorKey: 'price',
                header: "Price",
                cell: info => info.getValue().toLocaleString() + " Z",
                meta: {
                    className: "px-3 py-3.5 text-left text-sm font-semibold text-gray-900 sticky top-0",
                    itemClassName: "whitespace-nowrap px-3 py-4 text-sm text-gray-500 text-strong font-bold text-zinc-900"
                }
            },
            {
                id: 'amount',
                accessorKey: 'amount',
                header: "Amount",
                meta: {
                    className: "px-3 py-3.5 text-left text-sm font-semibold text-gray-900 sticky top-0",
                    itemClassName: "whitespace-nowrap px-3 py-4 text-sm text-gray-500"
                }
            },
            {
                id: 'total',
                accessorKey: 'total',
                header: "Total",
                cell: info => info.getValue().toLocaleString() + " Z",
                meta: {
                    className: "px-3 py-3.5 text-left text-sm font-semibold text-gray-900 sticky top-0",
                    itemClassName: "whitespace-nowrap px-3 py-4 text-sm text-gray-500 text-strong font-bold text-zinc-900"
                }
            },
            {
                id: 'account',
                accessorKey: 'account',
                header: "Account",
                meta: {
                    className: "px-3 py-3.5 text-left text-sm font-semibold text-gray-900 sticky top-0",
                    itemClassName: "whitespace-nowrap px-3 py-4 text-sm text-gray-500"
                }
            },
            {
                id: 'storage',
                accessorKey: 'storage',
                header: "Storage",
                meta: {
                    className: "px-3 py-3.5 text-left text-sm font-semibold text-gray-900 sticky top-0",
                    itemClassName: "whitespace-nowrap px-3 py-4 text-sm text-gray-500"
                }
            },
        ]
        const [sorting, setSorting] = React.useState([])
        const [pagination, setPagination] = React.useState({
            pageIndex: 0,
            pageSize: 10,
        })
        const table = ReactTable.useReactTable({
            columns,
            data,
            getCoreRowModel: ReactTable.getCoreRowModel(),
            getSortedRowModel: ReactTable.getSortedRowModel(),
            getPaginationRowModel: ReactTable.getPaginationRowModel(),
            onSortingChange: setSorting,
            onPaginationChange: setPagination,
            state: {
                sorting,
                pagination,
            },
        })

        return (
            <>
                <div className="sm:flex sm:items-center pt-8">
                    <div className="sm:flex-auto">
                        <h1 className="text-base font-semibold leading-6 text-gray-900">Items</h1>
                    </div>
                </div>
                <div className="mt-4 flow-root">
                    <div className="-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
                        <div className="inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8">
                            <div className="overflow-hidden shadow ring-1 ring-black ring-opacity-5 sm:rounded-lg">
                                <table id="data-table" className="min-w-full divide-y divide-gray-300 max-h-[500px] overflow-y-auto">
                                    <thead className="bg-gray-50">
                                        {table.getHeaderGroups().map(headerGroup => (
                                            <tr key={headerGroup.id}>
                                                {headerGroup.headers.map(header => {
                                                    return (
                                                        <th key={header.id} colSpan={header.colSpan} className={header.column.columnDef.meta.className}>
                                                            {header.isPlaceholder ? null : (
                                                                <div
                                                                    className={
                                                                        header.column.getCanSort()
                                                                            ? 'cursor-pointer select-none'
                                                                            : ''
                                                                    }
                                                                    onClick={header.column.getToggleSortingHandler()}
                                                                    title={
                                                                        header.column.getCanSort()
                                                                            ? header.column.getNextSortingOrder() === 'asc'
                                                                                ? 'Sort ascending'
                                                                                : header.column.getNextSortingOrder() === 'desc'
                                                                                    ? 'Sort descending'
                                                                                    : 'Clear sort'
                                                                            : undefined
                                                                    }
                                                                >
                                                                    {ReactTable.flexRender(
                                                                        header.column.columnDef.header,
                                                                        header.getContext()
                                                                    )}
                                                                    {{
                                                                        asc: ' ðŸ”¼',
                                                                        desc: ' ðŸ”½',
                                                                    }[header.column.getIsSorted()] ?? null}
                                                                </div>
                                                            )}
                                                        </th>
                                                    )
                                                })}
                                            </tr>
                                        ))}
                                    </thead>
                                    <tbody id="content" className="divide-y divide-gray-200 bg-white max-h-[500px]">
                                        {table
                                            .getRowModel()
                                            .rows.slice(0, 10)
                                            .map(row => {
                                                return (
                                                    <tr key={row.id}>
                                                        {row.getVisibleCells().map(cell => {
                                                            return (
                                                                <td key={cell.id} className={cell.column.columnDef.meta.itemClassName}>
                                                                    {ReactTable.flexRender(
                                                                        cell.column.columnDef.cell,
                                                                        cell.getContext()
                                                                    )}
                                                                </td>
                                                            )
                                                        })}
                                                    </tr>
                                                )
                                            })}
                                    </tbody>
                                </table>
                                <nav
                                    aria-label="Pagination"
                                    className="flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6"
                                >
                                    <div className="hidden sm:block">
                                        <p className="text-sm text-gray-700">
                                            <span className="font-medium">{data.length}</span> results
                                        </p>
                                    </div>
                                    <select
                                        value={table.getState().pagination.pageSize}
                                        onChange={e => {
                                            table.setPageSize(Number(e.target.value))
                                        }}
                                        className="ml-4 block rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6"
                                    >
                                        {[10, 20, 30, 40, 50].map(pageSize => (
                                            <option key={pageSize} value={pageSize}>
                                                Show {pageSize}
                                            </option>
                                        ))}
                                    </select>
                                    <div className="flex flex-1 justify-between sm:justify-end">
                                        <button
                                            onClick={() => table.previousPage()}
                                            disabled={!table.getCanPreviousPage()}
                                            className="relative inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus-visible:outline-offset-0"
                                        >
                                            Previous
                                        </button>
                                        <button
                                            onClick={() => table.nextPage()}
                                            disabled={!table.getCanNextPage()}
                                            className="relative ml-3 inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus-visible:outline-offset-0"
                                        >
                                            Next
                                        </button>
                                    </div>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>

            </>
        )
    }
</script>



<!-- 
<script>



    var data = [
        {
            "itemId": "720",
            "account": "judedaryl2",
            "storage": "Storage II",
            "name": "Aquamarine",
            "amount": 1,
            "price": 23279,
            "total": 23279
        },
        {
            "itemId": "720",
            "account": "<Master>",
            "storage": "Master Storage",
            "name": "Aquamarine",
            "amount": 42,
            "price": 23279,
            "total": 977718
        },
        {
            "itemId": "720",
            "account": "judedaryl",
            "storage": "Storage II",
            "name": "Aquamarine",
            "amount": 14,
            "price": 23279,
            "total": 325906
        },
        {
            "itemId": "985",
            "account": "judedaryl",
            "storage": "Storage I",
            "name": "Elunium",
            "amount": 1,
            "price": 37830,
            "total": 37830
        },
        {
            "itemId": "985",
            "account": "<Master>",
            "storage": "Master Storage",
            "name": "Elunium",
            "amount": 314,
            "price": 37830,
            "total": 11878620
        },
        {
            "itemId": "985",
            "account": "judedaryl",
            "storage": "Storage II",
            "name": "Elunium",
            "amount": 45,
            "price": 37830,
            "total": 1702350
        }
    ]
    const stats = document.getElementById('stats')
    const table = document.getElementById('data-table').getElementsByTagName('tbody')[0];
    data.forEach(v => addRow(v))

    renderStats();

    function renderStats() {
        const storageStats = data.reduce((a, b) => {
            const key = `${b.storage}: ${b.account}`
            if (!!a[key]) {
                a[key] += b.total
            } else {
                a[key] = b.total
            }
            return a
        }, {})

        const total = data.reduce((a, b) => a += b.total, 0)

        renderStat('All', total)
        Object.keys(storageStats).forEach(key => {
            renderStat(key, storageStats[key])
        })
    }


    function renderStat(name, value) {
        const text = `
            <div class="overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6">
                <dt class="truncate text-sm font-medium text-gray-500">${name}</dt>
                <dd class="mt-1 text-3xl font-semibold tracking-tight text-gray-900">${(value).toLocaleString()} Z</dd>
            </div>
        `
        stats.insertAdjacentHTML('beforeend', text)
    }




    function addRow(item = data[0]) {
        const row = table.insertRow(-1);
        const id = createCell(row, 0, item.itemId)
        id.className = "whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6"
        createCell(row, 1, item.name)
        createCell(row, 2, item.price?.toLocaleString()).className += ' text-strong font-bold text-zinc-900'
        createCell(row, 3, item.amount)
        createCell(row, 4, item.total.toLocaleString()).className += ' text-strong font-bold text-zinc-900'
        createCell(row, 5, item.storage)
        createCell(row, 6, item.account)
    }

    function createCell(row, position, value) {
        const cell = row.insertCell(position)
        cell.innerHTML = value;
        cell.className = "whitespace-nowrap px-3 py-4 text-sm text-gray-500"
        return cell;
    }

</script> -->

<script type="text/babel">
    const container = document.getElementById('root');
    ReactDOM.createRoot(container).render(<App />);
</script>

</html>
